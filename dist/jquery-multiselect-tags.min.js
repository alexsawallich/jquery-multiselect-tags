/*! jquery-multiselect-tags v0.5.0 by Alex Sawallich */
!function(a){function b(b,c){if("SELECT"!=b.prop("tagName")||!b.attr("multiple"))throw Error("Wrong element. jquery-multiselect-tags can only be applied to SELECT-elements with the MULTIPLE-attribute!");this.$element=b,this.options=a.extend(this.DEFAULTS,c),this.$wrapper,this.$tagContainer,this.$tagInput,this.initMarkup()}b.prototype.initMarkup=function(){this.$element.hide(),this.$element.wrap('<div class="form-control" />'),this.$wrapper=this.$element.parent(".form-control"),this.$tagContainer=a('<ul class="list-inline" style="display: inline;"></ul>'),this.$wrapper.append(this.$tagContainer),this.$tagContainer.on("click","[data-remove]",a.proxy(function(b){b.preventDefault();var c=a(b.currentTarget).closest("li"),d=c.attr("data-value");this.unselectOption(d)},this)),this.$tagInput=a('<input type="text" class="tag-input">'),this.$tagContainer.after(this.$tagInput),this.$wrapper.on("click",a.proxy(function(a){a.preventDefault(),this.$tagInput.focus()},this)),1==this.options.enableBackspaceRemove&&this.$tagInput.on("keydown",a.proxy(function(a){if(""==this.$tagInput.val()&&8==a.which){var b=this.$tagContainer.find("li:last").last().attr("data-value");this.unselectOption(b)}},this)),this.$tagInput.on("keypress",a.proxy(function(a){if(""!=this.$tagInput.val()&&13==a.which){a.preventDefault();var b=this.findValueByLabel(this.$tagInput.val());this.selectOption(b,!1),this.$tagInput.val("").typeahead("close")}},this)),1==this.options.enableTypeahead&&(this.initTypeahead(),this.$tagInput.on("typeahead:select",a.proxy(function(a,b,c){this.selectOption(b.value),this.$tagInput.val("").typeahead("close")},this)));var b=this.$element.val();for(i in b)this.selectOption(b[i],!0);this.$element.trigger("multiselecttags.init")},b.prototype.initTypeahead=function(){var b=[];this.$element.find("option").each(function(){b.push({value:a(this).attr("value"),label:a(this).text()})}),this.$tagInput.typeahead({minLength:1,highlight:!0,hint:!1},{name:"my-dataset",source:this.typeaheadCb(b),displayKey:"label"})},b.prototype.findValueByLabel=function(b){Regex=new RegExp(b,"i");var c=b;return this.$element.find("option").each(function(){Regex.test(a(this).text())&&(c=a(this).attr("value"))}),c},b.prototype.typeaheadCb=function(b){return function(c,d){var e,f;e=[],f=new RegExp(c,"i"),a.each(b,function(a,b){f.test(b.label)&&e.push({value:b.value,label:b.label})}),d(e)}},b.prototype.unselectOption=function(a){this.$tagContainer.find('li[data-value="'+a+'"]').remove(),this.$element.find('option[value="'+a+'"]').removeAttr("selected"),this.$element.trigger("multiselecttags.unselected")},b.prototype.selectOption=function(b,c){var d=this.$element.find('option[value="'+b+'"]');if(d.length<=0){if(1!=this.options.allowNewTags){var e=a('<li class="text-danger">Adding new tags is not allowed.</li>');return this.$tagContainer.append(e),window.setTimeout(function(){e.fadeOut("slow",function(){a(this).remove()})},2e3),this.$element.trigger("multiselecttags.notAllowedToAddNewTag"),this.$tagInput.val("").focus(),void(1==this.options.enableTypeahead&&this.$tagInput.typeahead("close"))}this.$element.trigger("multiselecttags.beforeAddNewTag",[b]),d=a('<option value="'+b+'">'+b+"</option>"),this.$element.append(d),1==this.options.enableTypeahead&&(this.$tagInput.typeahead("destroy"),this.initTypeahead()),this.$element.trigger("multiselecttags.afterAddNewTag",[b])}return d.attr("selected")&&1!=c?(this.$tagContainer.find('li[data-value="'+b+'"]').animate({opacity:"0"},200),this.$tagContainer.find('li[data-value="'+b+'"]').animate({opacity:"1"},200),this.$tagContainer.find('li[data-value="'+b+'"]').animate({opacity:"0"},200),this.$tagContainer.find('li[data-value="'+b+'"]').animate({opacity:"1"},200),this.$element.trigger("multiselecttags.alreadySelected"),this.$tagInput.val("").focus(),void(1==this.options.enableTypeahead&&this.$tagInput.typeahead("close"))):(d.attr("selected","selected"),this.$tagContainer.append('<li class="list-inline-item" data-value="'+b+'"><span style="font-size: 1em;" class="label label-primary">'+d.text()+' <span data-remove="" class="close" style="float: none; font-size: inherit;">&times;</span></span></li>'),this.$element.trigger("multiselecttags.selected"),this.$tagInput.val("").focus(),void(1==this.options.enableTypeahead&&this.$tagInput.typeahead("close")))},b.prototype.DEFAULTS={allowNewTags:!1,enableBackspaceRemove:!0,enableTypeahead:!1},Plugin=function(c){$elements=this,this.each(function(){var d=a(this),e=d.data("multiselecttags"),f="object"==typeof c&&c;e?e[c]:d.data("multiselecttags",e=new b(a(this),f))})},a.fn.multiselectTags=Plugin,a.fn.multiselectTags.Constructor=b}(jQuery);